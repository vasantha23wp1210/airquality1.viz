---
title: "2023MCS120010_MiniProject"
author: "2023MCS120010_PVasanthaselvi"
date: "10/26/2023"
output: html_document
---

## Objectives
1. Analysis and comparison of 6 year (2015-2020) Air quality Index  for 5 major cities
2. Analysis of key pollutants data to see if the dataset confirms to Benford's law to ensure naturalness and quality of dataset
3. Understanding the correlation between airquality parameters with temperature and precipitation
4. Analysis of Air quality and temperature through out the day and identify the peaks
5. Analysis of Airquality of Ahmadabad and different districts over different months for 6 year period
6. Impact of tree population on the Airquality for Ahmedabad
7. Understanding the correlation between pollutants and tree population
8. Predicting air quality for a given year, month and day 

```{r}
knit_print.data.frame = function(x, ...) {
  res = rmarkdown::paged_table(x)
  rmarkdown:::knit_print.data.frame(res)
}

registerS3method(
  "knit_print", "data.frame", knit_print.data.frame,
  envir = asNamespace("knitr")
)
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Preliminary analysis
The preliminary analysis involves loading, inspection and cleaning of the Air quality and weather datasets. As part of this activity, primary inspection conducted on the data set to understand the different variables, types and missing information based on visual and numerical analysis. Data cleaning is performed to remove unusable data entries/rows with incomplete cases or missing data.Further various operations performed to create clean, reduced or combined data set for further analysis. 
```{r}
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(stringr)
library(lubridate)
library(leaflet)
library(lazyeval)
library(mosaic)
library(mosaicData)
install.packages("Datasets/statisticalModeling_0.3.0.tar.gz", repos = NULL, type = "source")
library(statisticalModeling)
```
```{r}
city_day<-read.csv("./Datasets/Air_Quality/city_day.csv")
city_hour<-read.csv("./Datasets/Air_Quality/city_hour.csv")
station_day<-read.csv("./Datasets/Air_Quality/station_day.csv")
station_hour<-read.csv("./Datasets/Air_Quality/station_hour.csv")
stations<-read.csv("./Datasets/Air_Quality/stations.csv")
blr_wthr<-read.csv("./Datasets/Temperature_And_Precipitation_Cities_IN/Bangalore_1990_2022_BangaloreCity.csv")
chn_wthr<-read.csv("./Datasets/Temperature_And_Precipitation_Cities_IN/Chennai_1990_2022_Madras.csv")
dlhi_wthr<-read.csv("./Datasets/Temperature_And_Precipitation_Cities_IN/Delhi_NCR_1990_2022_Safdarjung.csv")
lucknw_wthr<-read.csv("./Datasets/Temperature_And_Precipitation_Cities_IN/Lucknow_1990_2022.csv")
mum_wthr<-read.csv("./Datasets/Temperature_And_Precipitation_Cities_IN/Mumbai_1990_2022_Santacruz.csv")
geo_data<-read.csv("./Datasets/Temperature_And_Precipitation_Cities_IN/Station_GeoLocation_Longitute_Latitude_Elevation_EPSG_4326.csv")
bhu_wthr<-read.csv("./Datasets/Temperature_And_Precipitation_Cities_IN/weather_Bhubhneshwar_1990_2022.csv")
rourkela_wthr<-read.csv("./Datasets/Temperature_And_Precipitation_Cities_IN/weather_Rourkela_2021_2022.csv")
rajas_wthr<-read.csv("./Datasets/Temperature_And_Precipitation_Cities_IN/Rajasthan_1990_2022_Jodhpur.csv")
```

## Exploratory Analysis of datasets

```{r}
#city_day
head(city_day)
summary(city_day)
#glimpse(city_day)
#str(city_day)
nrow(city_day)
ncol(city_day)
city_day <- replace(city_day, city_day=="", NA)
cd_na_total_per <-data.frame(colname = names(city_day),Total_NAs = colSums(is.na(city_day)), "PerctOfNAs" = colSums((is.na(city_day)/sum(is.na(city_day)) * 100)))
cd_na_total_per
ggplot(cd_na_total_per, aes(x=colname, y=PerctOfNAs))+geom_col() 

maxna <-max(rowSums(is.na(city_day)))
cd_rowswithmaxna<-subset(city_day, rowSums(is.na(city_day)) == maxna)
#cd_rowswithmorena
head(cd_rowswithmaxna)
city_day<-subset(city_day, rowSums(is.na(city_day)) != maxna)
#city_day
city_day[58,]
sum(is.na(city_day[58,]))
cd_rowswithonlyna<-sum(rowSums(is.na(city_day)) == 14)
cd_rowswithonlyna
head(city_day)
city_day <- replace(city_day, city_day=="", NA)%>%drop_na(AQI_Bucket)
city_day$AQI_Bucket <- as.factor(city_day$AQI_Bucket)
city_day$Date <- as.Date(city_day$Date)
#str(city_day)
summary(city_day)
dropcol<-c("PM10", "Toluene", "Benzene", "Xylene")#, "NH3")
#city_day<-city_day[,dropcol,drop=FALSE]
city_day<-subset(city_day, select=-c(PM10, Toluene, Benzene, Xylene))#, NH3))
head(city_day)
```
With the initial glimpse on the city air quality data the following characteristics and anomalies were observed. The dataset contains different Indian cities Air pollutant information, air quality index and air quality bucket or index from year 2015 to 2020. The summary indicates there are incomplete or missing variable values through out the dataset and across different columns.The rows with maximum number of NAs has only the date and city name, those rows may not be useful and can be removed.
AQI_Bucket has categorical variable and has missing values in various rows and that is not filled with NA and is of type character.The missing information is in different columns but it has useful measurements or values in other rows.This required further analysis if those rows can be dropped or retained. There are rows with AQI and AQI_Bucket but missing values in certain columns, those rows can be retained considering there could be correlated information but with row not have AQI and AQI_Bucket can be considered for dropping.The missing values or null strings can be filled with NA and AQI_Bucket type can be converted to factor. Dropping columns or variables higher than 10% and the variables not required for analysis. Based on this dropping columns PM10, Benzene, Toluene and Xylene.


The analysis will only focus on major cities ie Ahmedabad, Chennai, Bhubaneswar, Bengaluru, Delhi, Mumbai and Rajastan. The following dataset processing will focus to extract data only for the interested cities

```{r}
major_city_day<-city_day%>%filter(City %in% c("Ahmedabad", "Chennai",  "Bengaluru", "Delhi","Mumbai"))
summary(major_city_day)
unique(city_day$City)
unique(major_city_day$City)
```
## Checking Benfordness of the data set to see if the dataset is complete and usable for analyes
Benfordness is checked without using Benford.analyis package instead used only basic functions from packages covered under course
```{r}
firstDigit<-function(x){
 str_extract(x, "[123456789]")
  #as.numeric(x)
  #x=x^2
}
BenfordConfirmity<-function(x, y){
  x=floor(x) + signif(x, 2)
  if(0.000 <= x && x < 0.006)
      print(paste(y, "Dataset has Close confirmity with Mean abosolute Deviation", x))
  else if(0.006 <= x && x < 0.012)
    print(paste(y , "Dataset has Acceptable confirmity with Mean abosolute Deviation", x))
  else if(0.012 <= x && x <= 0.015)
     print(paste(y, "Dataset has Marginally Acceptable confirmity with Mean abosolute Deviation", x))
  else if(x > 0.015)
    print(paste(y, "Dataset has no confirmity with Mean abosolute Deviation", x))
}
major_city_day_first_digit <-city_day %>% mutate(across(seq(3:13), firstDigit))%>%subset(select=-c(1,2,12))

PM2.5FD_Counts<-as.vector(table(major_city_day_first_digit$PM2.5))
PM2.5first_digit_actual_vs_expected <- data.frame(
digit            = 1:9,
actual.count     = PM2.5FD_Counts,    
actual.fraction  = PM2.5FD_Counts / nrow(major_city_day_first_digit),
benford.fraction = log10(1 + 1 / (1:9))
)
PM2.5first_digit_actual_vs_expected<-PM2.5first_digit_actual_vs_expected %>%mutate(difference.fraction=abs(benford.fraction-actual.fraction))
PM2.5first_digit_actual_vs_expected
BenfordConfirmity(mean(PM2.5first_digit_actual_vs_expected$difference.fraction), "PM2.5")

NOFD_Counts<-as.vector(table(major_city_day_first_digit$NO))
NOfirst_digit_actual_vs_expected <- data.frame(
digit            = 1:9,
actual.count     = NOFD_Counts,    
actual.fraction  = NOFD_Counts / nrow(major_city_day_first_digit),
benford.fraction = log10(1 + 1 / (1:9))
)
NOfirst_digit_actual_vs_expected<-NOfirst_digit_actual_vs_expected %>%mutate(difference.fraction=abs(benford.fraction-actual.fraction))
NOfirst_digit_actual_vs_expected
BenfordConfirmity(mean(NOfirst_digit_actual_vs_expected$difference.fraction), "NO")


O3FD_Counts<-as.vector(table(major_city_day_first_digit$O3))
O3first_digit_actual_vs_expected <- data.frame(
digit            = 1:9,
actual.count     = O3FD_Counts,    
actual.fraction  = O3FD_Counts / nrow(major_city_day_first_digit),
benford.fraction = log10(1 + 1 / (1:9))
)
O3first_digit_actual_vs_expected<-O3first_digit_actual_vs_expected %>%mutate(difference.fraction=abs(benford.fraction-actual.fraction))
O3first_digit_actual_vs_expected
BenfordConfirmity(mean(O3first_digit_actual_vs_expected$difference.fraction), "O3")


SO2FD_Counts<-as.vector(table(major_city_day_first_digit$SO2))
SO2first_digit_actual_vs_expected <- data.frame(
digit            = 1:9,
actual.count     = SO2FD_Counts,    
actual.fraction  = SO2FD_Counts / nrow(major_city_day_first_digit),
benford.fraction = log10(1 + 1 / (1:9))
)
SO2first_digit_actual_vs_expected<-SO2first_digit_actual_vs_expected %>%mutate(difference.fraction=abs(benford.fraction-actual.fraction))
SO2first_digit_actual_vs_expected
BenfordConfirmity(mean(SO2first_digit_actual_vs_expected$difference.fraction), "SO2")

```

```{r}
city_day_monthwise<-major_city_day%>%group_by(City, year=year(Date), month = month(Date))%>%summarise(across(c(seq(3:13)), mean, na.rm=TRUE))
city_day_monthwise
ggplot(city_day_monthwise, aes(x=month, y=AQI, color=factor(year))) + geom_line() + facet_wrap(~City) + scale_x_continuous(name ="month", breaks = seq(1, 12, 1))

city_day_yearwise<-major_city_day%>%group_by(City, year=year(Date))%>%summarise(across(c(seq(3:13)), mean, na.rm=TRUE))%>%filter(City %in% c("Ahmedabad", "Chennai", "Bengaluru", "Delhi","Mumbai"))
#city_day_yearwise
ggplot(city_day_yearwise, aes(x=year)) + geom_line(aes(y=PM2.5, color="PM2.5")) + facet_wrap(~City, nrow=5)

ggplot(city_day_yearwise, aes(x=year)) + geom_line(aes(y=NO, color="NO")) + geom_line(aes(y=NO2, color="NO2")) + geom_line(aes(y=NOx, color="NOx"))+ facet_wrap(~City, nrow=5)
ggplot(city_day_yearwise, aes(x=year)) + geom_line(aes(y=SO2, color="SO2")) + facet_wrap(~City, nrow=5)
ggplot(city_day_yearwise, aes(x=year)) + geom_line(aes(y=CO, color="CO")) + facet_wrap(~City, nrow=5)
ggplot(city_day_yearwise, aes(x=year)) + geom_line(aes(y=O3, color="O3")) + facet_wrap(~City, nrow=5)
ggplot(city_day_yearwise, aes(x=year)) + geom_bar(aes(y=NH3, color=City, na.rm=TRUE)) #+ facet_wrap(~City, nrow=5)

```


```{r}
city_hour
head(city_hour)
summary(city_hour)
maxna <-max(rowSums(is.na(city_hour)))
cd_rowswithmaxna<-subset(city_hour, rowSums(is.na(city_hour)) == maxna)
#cd_rowswithmorena
head(cd_rowswithmaxna)
city_hour<-subset(city_hour, rowSums(is.na(city_hour)) != maxna)
#city_hour
head(city_hour)
city_hour <- replace(city_hour, city_hour=="", NA)%>% drop_na(AQI_Bucket)
city_hour$AQI_Bucket <- as.factor(city_hour$AQI_Bucket)
#str(city_hour)
summary(city_hour)
head(city_hour)
tail(city_hour)
```

```{r}

nrow(station_day)
ncol(station_day)
head(station_day)
summary(station_day)
maxna <-max(rowSums(is.na(station_day)))
cd_rowswithmaxna<-subset(station_day, rowSums(is.na(station_day)) == maxna)
#cd_rowswithmorena
head(cd_rowswithmaxna)
station_day<-subset(city_hour, rowSums(is.na(station_day)) != maxna)
#station_day
head(station_day)
station_day <- replace(station_day, station_day=="", NA)%>% drop_na(AQI_Bucket)
station_day$AQI_Bucket <- as.factor(station_day$AQI_Bucket)
#str(station_day)
summary(station_day)
head(station_day)
tail(station_day)

```


```{r}
head(station_hour)
summary(station_hour)
maxna <-max(rowSums(is.na(station_hour)))
cd_rowswithmaxna<-subset(station_hour, rowSums(is.na(station_hour)) == maxna)
#cd_rowswithmorena
head(cd_rowswithmaxna)
station_hour<-subset(city_hour, rowSums(is.na(station_hour)) != maxna)
#station_hour
head(station_hour)
station_hour <- replace(station_hour, station_hour=="", NA)%>% drop_na(AQI_Bucket)
station_hour$AQI_Bucket <- as.factor(station_hour$AQI_Bucket)
#str(station_hour)
summary(station_hour)
head(station_hour)
tail(station_hour)
```


```{r}
head(stations)
summary(stations)
```

```{r}
head(blr_wthr)
head(chn_wthr)
head(dlhi_wthr)
head(lucknw_wthr)
head(mum_wthr)
head(geo_data)
head(bhu_wthr)
head(rourkela_wthr)
head(rajas_wthr)
```



## Detailed analysis



## Outcomes



## Results and Discussions